Простое web приложение на spring web и spring data jpa (для простоты, в нашем проекте будут другие технологии)

**_Для запуска приложения_**: зайти в консоль в папке dev_env, ввести:

1. **docker compose up**

_docker compose up -d_ чтобы остаться работать в этой же консоли.
После этого, вы можете проверить работоспособность приложения: зайдите в браузер по адресу:

http://localhost:80/product - вам должно вернутся приветствие

http://localhost:80/product/1 - вам должна вернуться сущность Product в формате JSON: {"id":1, "title":"Beer"}. В БД есть 10 (1-10) сущностей

Для **завершения приложения** можно воспользоваться Docker desktop приложением, или в консоли ввести **docker compose down** (консоль должна быть открыта в папке dev_env).
Java приложение компилируется непосредственно в docker контейнере, поэтому нам не нужно загружать jar файл на гитхаб. Но есть ньюансы.

**_Если вы хотите запустить новую версию приложения или обновилась БД_**, необходимо перед командой 1. выполнить:
2. **docker image rm backend-app** 

___________________^^^^^^^^^^^^ здесь backend-app имя образа, которое записано в файле dev_env\docker-compose.yml
Эта команда удалит образ java приложения, и при запуске 1. команды будет создан новый образ. 
**Не рекомендую** использовать docker compose up --build для обновления приложения или БД: старый образ не удалится, создастся новый, и так каждый раз ==> лишняя нагрузка со стороны докера 

P.s. чтобы каждый раз себе не скачивать eclipse-temurin:21 , выполните команду docker pull eclipse-temurin:21 -> у вас будет отдельно записанный image для него, и он не сотрется, если вы удалите image для BackendApp.

P.p.s. Периодически советую делать команду docker builder prune - она почистит сохраненный кэш, который используется при создании новых образов (я так почистил 4 гб)

С какими проблемами я столкнулся:

1. datasource url и др. properties указаны в файле application.properties как переменная. В нашем случае эта переменная будет браться из переменных окружения, которые будут зашиты в docker compose файле. При выполнении команд mvn clean install, в данном случае тесты валятся, т.к. у спринга не получается поднять контекст - он не видит переменные окружения (хотя я пробовал добавить их в переменные окружения Windows 10 у себя на хосте). 
-Как решить это проблему: либо указать параметр запуска mvn: **mvn clean -DskipTests package** (тогда тесты просто не будут выполняться), либо в папке src/test/resources/ создать файл application-test.properties - это файл, который maven (spring ?) автоматически распознает как properties для profile "test". Но в этом случае, должна быть поднята БД, и к этой бд нужно указать соответствующие url, user, password. Тут нужно будет разобраться, как тест сконнектить с test-container

    **update**: внедрил в тесты testcontainer для postgres, теперь тесты не падают, но в самом докере тесты отключил, чтобы сборка производилась быстрее. Нужно ли это?

2. при создании дампа БД через утилиту pg_dump у меня создавался скрипт с кодировкой UTF-16, и в докер контейнере бд не могла инициализироваться из-за разной кодировки. При создании дампа указывайте перед именем файла --encoding utf8 -f file-name. Например: pg_dump -U postgres -d demo --encoding utf8 -f dev_env/initdb/dump.sql 
**Не используйте shell команду в терминале IDE!: ... --encoding uft8 > dev_env/initdb/dump.sql**, кодировка иначе будет кривая. Скорее всего, проблема windows юзера :(

Нужно будет еще включить в docker compose образ сервера для фронта, но я пока не знаю как это сделать.